#!/bin/sh -eux

all() {
    $HOME/local/bin/permissions-fixup
}

linux() {
    return  # TODO
}

mac() {
    command -v brew || ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    brew analytics off
    brew update
    brew upgrade

    brew install bash bash-completion@2
    BREW_BASH="/usr/local/bin/bash"
    grep "$BREW_BASH" /etc/shells || echo "$BREW_BASH" | sudo tee -a /etc/shells
    [ "$SHELL" = "$BREW_BASH" ] || chsh -s "$BREW_BASH"

    brew install git git-crypt gitleaks
    ln -sf "$(brew --prefix)/share/git-core/contrib/diff-highlight/diff-highlight" "$HOME/local/bin"
    git config --global credential.helper osxkeychain

    brew install vim
    brew install tmux
    brew cask install kitty

    brew cask install sublime-text
    brew cask install sublime-merge
    ln -sfh "$HOME/.config/sublime-text-3" "$HOME/Library/Application Support/Sublime Text 3"

    brew cleanup
    brew doctor
}

all

case $(uname) in
    Linux*) linux ;;
    Darwin*)  mac ;;
esac
